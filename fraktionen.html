<!DOCTYPE html>
<html>
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width, initial-scale=1.0"/>
<title>Fraktionen</title>

<script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
<script src="https://cdn.jsdelivr.net/npm/sortablejs@1.15.0/Sortable.min.js"></script>

<style>
*{ box-sizing:border-box; }

body{
  margin:0;
  background:#0e0e0e;
  font-family:Arial;
  color:white;
}

/* ===== SEARCH BAR ===== */
#topBar{
  position:sticky;
  top:0;
  padding:12px 24px 10px 24px;
  background:linear-gradient(to bottom, rgba(14,14,14,0.95), rgba(14,14,14,0.6), rgba(14,14,14,0));
  backdrop-filter: blur(10px);
  z-index:1000;
}

#searchWrap{ position:relative; display:inline-block; }

#searchIcon{
  position:absolute;
  left:12px;
  top:50%;
  transform:translateY(-50%);
  color:#00ffc3;
  font-size:14px;
}

#searchBox{
  width:min(340px, calc(100vw - 48px));
  padding:10px 12px 10px 34px;
  border-radius:8px;
  border:none;
  background:#222;
  color:white;
  outline:none;
}

/* ===== GRID ===== */
#container{
  display:flex;
  flex-wrap:wrap;
  gap:22px;
  padding:10px 24px 110px 24px;
}

/* ===== FRAKTION CARD ===== */
.card{
  padding:18px;
  border-radius:22px;
  min-width:320px;
  max-width:420px;
  flex:0 1 360px;
  background:#161616;
  box-shadow:0 0 25px #00ffc322;
  transition:0.25s;
}
.card:hover{
  transform:translateY(-6px);
  box-shadow:0 0 32px #00ffc344;
}
.card h3{
  margin:0 0 14px 0;
  font-size:20px;
  font-weight:800;
}

/* ===== MEMBER LIST WRAP ===== */
.memberList{
  background:rgba(255,255,255,0.02);
  border-radius:16px;
  padding:8px;
}

/* ===== MEMBER ROW (NEU SCHÃ–N) ===== */
.member{
  background:linear-gradient(145deg, rgba(35,35,35,0.9), rgba(15,15,15,0.9));
  border:1px solid rgba(255,255,255,0.05);
  padding:12px 14px;
  border-radius:14px;
  margin-bottom:10px;
  display:flex;
  justify-content:space-between;
  align-items:center;
  cursor:grab;
  transition:0.2s ease;
}

.member:last-child{ margin-bottom:0; }

.member:hover{
  border:1px solid rgba(0,255,195,0.35);
  box-shadow:0 0 18px rgba(0,255,195,0.15);
}

.memberLeft{
  display:flex;
  align-items:center;
  gap:10px;
}

.memberName{
  font-size:14px;
  font-weight:700;
  color:#f1f1f1;
  letter-spacing:0.3px;
}

/* ===== LEADER ===== */
.leader-star{
  cursor:pointer;
  font-size:16px;
  opacity:0.9;
}
.leader-active{
  color:#ffd54a;
  text-shadow:0 0 10px rgba(255,213,74,0.35);
}
.member .leader-active + .memberName{
  color:#fff4c7;
}

/* ===== DELETE BUTTON (SMALL) ===== */
.delBtn{
  background:rgba(255,59,59,0.18);
  border:1px solid rgba(255,59,59,0.45);
  color:#ff6b6b;
  border-radius:10px;
  padding:5px 8px;
  font-size:12px;
  font-weight:900;
  cursor:pointer;
}
.delBtn:hover{
  background:rgba(255,59,59,0.3);
  color:white;
}

/* ===== BUTTONS ===== */
button{
  padding:8px 14px;
  border:none;
  border-radius:8px;
  cursor:pointer;
  font-weight:bold;
  font-family:Arial;
}

.primary{
  background:#00ffc3;
  color:black;
  box-shadow:0 0 18px #00ffc322;
}

.dangerSoft{
  background:transparent;
  color:#ff6b6b;
  border:1px solid rgba(255,59,59,0.55);
}
.dangerSoft:hover{
  background:rgba(255,59,59,0.12);
  color:white;
}

.btnRow{
  display:flex;
  gap:12px;
  margin-top:14px;
}

/* ===== ADD FORM ===== */
.add-form{
  display:none;
  flex-direction:column;
  gap:10px;
  margin-top:12px;
  padding:12px;
  border-radius:16px;
  background:rgba(0,0,0,0.18);
  border:1px solid rgba(255,255,255,0.05);
}
.add-form input{
  padding:10px;
  border-radius:8px;
  border:none;
  background:#222;
  color:white;
}

/* ===== BACK BUTTON ===== */
#backBtn{
  position:fixed;
  bottom:20px;
  right:20px;
  background:#00ffc3;
  color:black;
  padding:12px 16px;
  border-radius:12px;
  font-weight:bold;
  cursor:pointer;
  box-shadow:0 0 20px #00ffc355;
}

/* ===== HEADER BUTTONS ===== */
#logoutBtn{
  position:fixed;
  top:10px;
  right:0;
  background:#ff3b3b;
  color:white;
  padding:8px 12px;
  border-radius:8px 0 0 8px;
  cursor:pointer;
  display:none;
}

#adminToggle{
  position:fixed;
  top:50px;
  right:0;
  background:#00ffc3;
  color:black;
  padding:8px 12px;
  border-radius:8px 0 0 8px;
  cursor:pointer;
  display:none;
}

#adminPanel{
  position:fixed;
  top:90px;
  right:-340px;
  width:300px;
  background:#161616;
  padding:20px;
  border-radius:15px 0 0 15px;
  box-shadow:0 0 25px #00ffc322;
  transition:0.4s;
}
#adminPanel.open{ right:0; }
#adminPanel input{
  width:100%;
  padding:10px;
  margin:8px 0;
  border-radius:8px;
  border:none;
  background:#222;
  color:white;
}
</style>
</head>

<body>

<div id="topBar">
  <div id="searchWrap">
    <span id="searchIcon">ðŸ”Ž</span>
    <input id="searchBox" placeholder="Fraktion oder Mitglied suchen...">
  </div>
</div>

<div id="container"></div>

<button id="backBtn" onclick="window.location='index.html'">â¬… ZurÃ¼ck</button>
<button id="logoutBtn" onclick="logout()">Logout</button>
<div id="adminToggle">Admin</div>

<div id="adminPanel">
  <h3 style="color:#00ffc3;">Fraktion erstellen</h3>
  <input id="fName" placeholder="Fraktionsname">
  <input id="fColor" type="color" value="#00ffc3">
  <button class="primary" style="width:100%;" onclick="createFraktion()">Erstellen</button>
</div>

<script>
const SUPABASE_URL="SUPABASE_URL = "https://lleldalugvgmgqekcolx.supabase.co";
const SUPABASE_KEY="eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImxsZWxkYWx1Z3ZnbWdxZWtjb2x4Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NzE3OTg4OTgsImV4cCI6MjA4NzM3NDg5OH0.CuiVJ9kWraso1tLEJ3D6V4IssYGVeWaLs2ygerVU5tc";
const db=supabase.createClient(SUPABASE_URL,SUPABASE_KEY);

let inactivityTimer;

function resetInactivityTimer(){
  clearTimeout(inactivityTimer);
  inactivityTimer=setTimeout(()=>{
    alert("Automatischer Logout (60 Minuten InaktivitÃ¤t)");
    logout();
  },60*60*1000);
}

document.addEventListener("mousemove",resetInactivityTimer);
document.addEventListener("keydown",resetInactivityTimer);
document.addEventListener("click",resetInactivityTimer);
document.addEventListener("touchstart",resetInactivityTimer);

window.onload=async()=>{
  const {data}=await db.auth.getSession();
  if(!data.session){window.location="index.html";return;}
  document.getElementById("logoutBtn").style.display="block";
  document.getElementById("adminToggle").style.display="block";
  resetInactivityTimer();
};

async function logout(){
  await db.auth.signOut();
  window.location="index.html";
}

function escapeHtml(str){
  return String(str)
  .replaceAll("&","&amp;")
  .replaceAll("<","&lt;")
  .replaceAll(">","&gt;")
  .replaceAll('"',"&quot;")
  .replaceAll("'","&#039;");
}
</script>
</body>
</html>

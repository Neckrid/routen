<!DOCTYPE html>
<html>
<head>
<meta charset="utf-8" />
<title>FiveM Server Map Editor</title>
<link rel="stylesheet" href="https://unpkg.com/leaflet/dist/leaflet.css" />
<style>
  body { margin:0; background:#111; font-family:Arial, sans-serif; }
  #map { height: 100vh; }
  #coordsBox {
    position:absolute;
    bottom:10px;
    left:10px;
    background:rgba(0,0,0,0.8);
    color:#00ff88;
    padding:8px 12px;
    border-radius:6px;
    font-size:14px;
    z-index:1000;
  }
  #exportBox {
    position:absolute;
    top:10px;
    right:10px;
    width:300px;
    height:240px;
    background:rgba(0,0,0,0.9);
    color:white;
    padding:10px;
    font-size:12px;
    overflow:auto;
    border-radius:6px;
    z-index:1000;
  }
  textarea {
    width:100%;
    height:140px;
    background:#222;
    color:#0f0;
    border:1px solid #333;
  }
  button {
    margin-top:5px;
    padding:4px 8px;
    cursor:pointer;
  }
</style>
</head>
<body>

<div id="map"></div>
<div id="coordsBox">X: 0 | Y: 0</div>

<div id="exportBox">
  <b>JSON Export:</b><br>
  <textarea id="jsonOutput"></textarea><br>
  <button onclick="copyJSON()">JSON kopieren</button>
  <button onclick="clearAll()">Alle Marker löschen</button>
</div>

<script src="https://unpkg.com/leaflet/dist/leaflet.js"></script>
<script>
const STORAGE_KEY = "fivem_map_markers";

const map = L.map('map', {
  crs: L.CRS.Simple,
  minZoom: -2,
  maxZoom: 2
});

const bounds = [[0,0], [8192,8192]];
L.imageOverlay("gta_map.png", bounds).addTo(map);
map.fitBounds(bounds);

let markersData = JSON.parse(localStorage.getItem(STORAGE_KEY)) || [];
let markersLayer = L.layerGroup().addTo(map);

// Maus Koordinaten anzeigen
map.on('mousemove', function(e) {
  const x = Math.round(e.latlng.lng);
  const y = Math.round(e.latlng.lat);
  document.getElementById("coordsBox").innerHTML =
    "X: " + x + " | Y: " + y;
});

// Marker hinzufügen
map.on('click', function(e) {
  const x = Math.round(e.latlng.lng);
  const y = Math.round(e.latlng.lat);

  const name = prompt("Name der Location:");
  if (!name) return;

  const description = prompt("Beschreibung:");

  markersData.push({ name, description, x, y });
  saveData();
  renderMarkers();
});

// Marker anzeigen
function renderMarkers() {
  markersLayer.clearLayers();

  markersData.forEach((loc, index) => {
    const marker = L.marker([loc.y, loc.x]).addTo(markersLayer);

    marker.bindPopup(`
      <b>${loc.name}</b><br>
      ${loc.description}<br><br>
      <button onclick="editMarker(${index})">Bearbeiten</button>
      <button onclick="deleteMarker(${index})">Löschen</button>
    `);
  });

  updateJSON();
}

// Marker bearbeiten
function editMarker(index) {
  const newName = prompt("Neuer Name:", markersData[index].name);
  if (newName === null) return;

  const newDesc = prompt("Neue Beschreibung:", markersData[index].description);

  markersData[index].name = newName;
  markersData[index].description = newDesc;

  saveData();
  renderMarkers();
}

// Marker löschen
function deleteMarker(index) {
  if (!confirm("Marker wirklich löschen?")) return;

  markersData.splice(index, 1);
  saveData();
  renderMarkers();
}

// Alles löschen
function clearAll() {
  if (!confirm("Wirklich ALLE Marker löschen?")) return;

  markersData = [];
  saveData();
  renderMarkers();
}

// Speichern im Browser
function saveData() {
  localStorage.setItem(STORAGE_KEY, JSON.stringify(markersData));
}

// JSON aktualisieren
function updateJSON() {
  document.getElementById("jsonOutput").value =
    JSON.stringify(markersData, null, 2);
}

// JSON kopieren
function copyJSON() {
  const textarea = document.getElementById("jsonOutput");
  textarea.select();
  document.execCommand("copy");
  alert("JSON kopiert!");
}

// Beim Laden Marker anzeigen
renderMarkers();

</script>

</body>
</html>
